name: build
on:
  - push

jobs:
  release:
    # needs: test
    runs-on: ubuntu-latest
    #if: github.ref == 'refs/heads/master'
    name: npm upload
    steps:
      - uses: actions/checkout@v2

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: bun install

      - name: upload
        run: |
          git submodule update --init --recursive
          make build
          echo "//registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}" > .npmrc
          npm publish || true
          #unlink katex/README.md && cp README.md katex/README.md
          #echo "//registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}" > katex/.npmrc
          #cd katex && npm publish || true
